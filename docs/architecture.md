# Архитектура сервиса

## Обзор
Сервис — это однопроцессный Python-скрипт, работающий в Docker. Он читает строки из Google Sheets, генерирует контент через OpenAI, создает товары в WooCommerce (с вариациями и атрибутами), публикует переводы и обновляет статус обработки.

## Основные компоненты
- `run/main.py`: оркестрация пайплайна, расписание запуска, логирование.
- `run/_1_google_loader.py`: доступ к Google Sheets, кеширование, обновления ячеек.
- `run/_2_content_generation.py`: извлечение текста, вызовы OpenAI, генерация изображений, геокодинг.
- `run/prompts/*.txt`: системные промпты для Responses API.
- `run/_3_create_product.py`: создание товара и категорий в WooCommerce, JWT токен.
- `run/_4_create_translation.py`: создание перевода товара и привязка через WPML API.
- `run/_5_taxonomy_and_attributes.py`: создание атрибутов и терминов, назначение атрибутов товару.
- `run/_6_create_variations.py`: создание вариаций товара с проверкой дубликатов.

## Поток данных
1. `main.py` читает строки из Google Sheets.
2. Для строк со статусом `revised` собираются данные, геокодинг, и извлекается текст сайтов/регламентов.
3. OpenAI генерирует структуру контента и, при необходимости, изображение.
4. Создается товар в WooCommerce, назначаются категории, атрибуты и вариации.
5. Создается перевод товара (PT) и связывается через WPML API.
6. В Google Sheets обновляется статус и вспомогательные поля.

## Интеграции
- Google Sheets API (gspread + Service Account).
- OpenAI Responses API (генерация текста) и OpenAI Images API (генерация изображений).
- OpenCage Geocoding API.
- WooCommerce REST API, WordPress JWT Auth, WPML custom API.

## Конфигурация
- Все параметры задаются через `.env` (см. `.env.example`).
- Модели, уровень размышления и пути к промптам задаются через переменные `OPENAI_*`.
- Файл `run/google-credentials.json` монтируется в контейнер и используется для доступа к Google API.

## Развертывание
- Запуск через `docker-compose.yml`.
- Планировщик в `main.py` управляет периодическим запуском по расписанию.
